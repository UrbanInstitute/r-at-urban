<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>getting-data.utf8</title>

<script src="site_libs/header-attrs-2.7/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-114294141-1"></script>
<script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-114294141-1');
</script>
			

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>





<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-sm-12 col-md-4 col-lg-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-sm-12 col-md-8 col-lg-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">R@URBAN</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">HOME</a>
</li>
<li>
  <a href="intro-to-r.html">INTRO TO R</a>
</li>
<li>
  <a href="graphics-guide.html">DATA VIZ</a>
</li>
<li>
  <a href="mapping.html">MAPPING</a>
</li>
<li>
  <a href="getting-data.html">GETTING DATA</a>
</li>
<li>
  <a href="optimization.html">OPTIMIZATION</a>
</li>
<li>
  <a href="resources.html">RESOURCES</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>




</div>


<p><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato" /></p>
<div id="header">
<p><img src="intro-to-r/images/urban-institute-logo.png" width="350"></p>
</div>
<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>This guide outlines some useful workflows for pulling data sets commonly used by the Urban Institute.</p>
</div>
<div id="librarytidycensus" class="section level2">
<h2><code>library(tidycensus)</code></h2>
<p><code>library(tidycensus)</code> by Kyle Walker (<a href="https://walkerke.github.io/tidycensus/">complete intro here</a>) is the best tool for accessing some Census data sets in R from the Census Bureau API. The package returns tidy data frames and can easily pull shapefiles by adding <code>geometry = TRUE</code>.</p>
<p>You will need to <a href="https://api.census.gov/data/key_signup.html">apply for a Census API key</a> and <a href="https://walkerke.github.io/tidycensus/articles/basic-usage.html">add it to your R session</a>. Don’t add your API key to your script and don’t add it to a GitHub repository!</p>
<p>Here is a simple example for one state with shapefiles:</p>
<pre class="r"><code>library(tidyverse)
library(purrr)
library(tidycensus)

# pull median household income and shapefiles for Census tracts in Alabama
get_acs(geography = &quot;tract&quot;, 
        variables = &quot;B19013_001&quot;, 
        state = &quot;01&quot;,
        year = 2015,
        geometry = TRUE,
        progress = FALSE)</code></pre>
<pre><code>## Simple feature collection with 1181 features and 5 fields (with 1 geometry empty)
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -88.47323 ymin: 30.22333 xmax: -84.88908 ymax: 35.00803
## Geodetic CRS:  NAD83
## First 10 features:
##          GEOID                                          NAME   variable
## 1  01003010500     Census Tract 105, Baldwin County, Alabama B19013_001
## 2  01003011501  Census Tract 115.01, Baldwin County, Alabama B19013_001
## 3  01009050500      Census Tract 505, Blount County, Alabama B19013_001
## 4  01015981901 Census Tract 9819.01, Calhoun County, Alabama B19013_001
## 5  01025957700     Census Tract 9577, Clarke County, Alabama B19013_001
## 6  01025958002  Census Tract 9580.02, Clarke County, Alabama B19013_001
## 7  01031011000      Census Tract 110, Coffee County, Alabama B19013_001
## 8  01033020500     Census Tract 205, Colbert County, Alabama B19013_001
## 9  01037961200      Census Tract 9612, Coosa County, Alabama B19013_001
## 10 01039961700  Census Tract 9617, Covington County, Alabama B19013_001
##    estimate   moe                       geometry
## 1     41944  8100 MULTIPOLYGON (((-87.80249 3...
## 2     41417 14204 MULTIPOLYGON (((-87.71719 3...
## 3     40055  8054 MULTIPOLYGON (((-86.75735 3...
## 4        NA    NA MULTIPOLYGON (((-86.01323 3...
## 5     32708  4806 MULTIPOLYGON (((-88.18049 3...
## 6     29048 14759 MULTIPOLYGON (((-87.98623 3...
## 7     44732  7640 MULTIPOLYGON (((-85.92018 3...
## 8     49052  6543 MULTIPOLYGON (((-87.76733 3...
## 9     31957  9954 MULTIPOLYGON (((-86.46069 3...
## 10    32697  6021 MULTIPOLYGON (((-86.6998 31...</code></pre>
<p>Smaller geographies like Census tracts can only be pulled state-by-state. This example demonstrates how to iterate across FIPS codes to pull Census tracts for multiple states. The process is as follows:</p>
<ol style="list-style-type: decimal">
<li>Pick the variables of interest</li>
<li>Create a vector of state FIPS codes for the states of interest</li>
<li>Create a custom function that works on a single state FIPS code</li>
<li>Iterate the function along the vector of state FIPS codes with <code>map_df()</code> from <code>library(purrr)</code></li>
</ol>
<p>Here is an example that pulls median household income at the Census tract level for multiple states:</p>
<pre class="r"><code># variables of interest
vars &lt;- c(
  &quot;B19013_001&quot;  # median household income estimate
)

# states of interest: alabama, alaska, arizona
state_fips &lt;- c(&quot;01&quot;, &quot;02&quot;, &quot;04&quot;)
  
# create a custom function that works for one state
get_income &lt;- function(state_fips) {
  
  income_data &lt;- get_acs(geography = &quot;tract&quot;, 
                         variables = vars, 
                         state = state_fips,
                         year = 2015)
  
  return(income_data)
  
}

# iterate the function
map_df(.x = state_fips, # iterate along the vector of state fips codes
       .f = get_income) # apply get_income() to each fips_code  </code></pre>
<pre><code>## # A tibble: 2,874 × 5
##    GEOID       NAME                                     variable  estimate   moe
##    &lt;chr&gt;       &lt;chr&gt;                                    &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt;
##  1 01001020100 Census Tract 201, Autauga County, Alaba… B19013_0…    61838 11900
##  2 01001020200 Census Tract 202, Autauga County, Alaba… B19013_0…    32303 13538
##  3 01001020300 Census Tract 203, Autauga County, Alaba… B19013_0…    44922  5629
##  4 01001020400 Census Tract 204, Autauga County, Alaba… B19013_0…    54329  7003
##  5 01001020500 Census Tract 205, Autauga County, Alaba… B19013_0…    51965  6935
##  6 01001020600 Census Tract 206, Autauga County, Alaba… B19013_0…    63092  9585
##  7 01001020700 Census Tract 207, Autauga County, Alaba… B19013_0…    34821  7867
##  8 01001020801 Census Tract 208.01, Autauga County, Al… B19013_0…    73728  2447
##  9 01001020802 Census Tract 208.02, Autauga County, Al… B19013_0…    60063  8602
## 10 01001020900 Census Tract 209, Autauga County, Alaba… B19013_0…    41287  7857
## # … with 2,864 more rows</code></pre>
<p><code>library(tidycensus)</code> works well with <code>library(tidyverse)</code> and enables access to geospatial data, but it is limited to only some Census Bureau data sets. The next package has less functionality but allows for accessing any data available on the Census API.</p>
<p><br></p>
</div>
<div id="librarycensusapi" class="section level2">
<h2><code>library(censusapi)</code></h2>
<p><code>library(censusapi)</code> by Hannah Recht (<a href="https://cran.r-project.org/web/packages/censusapi/vignettes/getting-started.html">complete intro here</a>) can access any published table that is accessible through the Census Bureau API. A full listing is available <a href="https://api.census.gov/data.html">here</a>.</p>
<p>You will need to <a href="https://api.census.gov/data/key_signup.html">apply for a Census API key</a> and <a href="https://cran.r-project.org/web/packages/censusapi/vignettes/getting-started.html">add it to your R session</a>. Don’t add your API key to your script and don’t add it to a GitHub repository!</p>
<p>Here is a simple example that pulls median household income and its margin of error for Census tracts in Alabama:</p>
<pre class="r"><code>library(tidyverse)
library(purrr)
library(censusapi)

vars &lt;- c(
  &quot;B19013_001E&quot;,  # median household income estimate
  &quot;B19013_001M&quot;   # median household income margin of error
)

getCensus(name = &quot;acs/acs5&quot;,
          vars = vars, 
          region = &quot;tract:*&quot;,
          regionin = &quot;state:01&quot;,
          vintage = 2015) %&gt;%
  as_tibble()</code></pre>
<pre><code>## # A tibble: 1,181 × 5
##    state county tract  B19013_001E B19013_001M
##    &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;        &lt;dbl&gt;       &lt;dbl&gt;
##  1 01    103    005109       29644        4098
##  2 01    103    005106       35864        3443
##  3 01    103    005107       66739        5468
##  4 01    103    005108       64632        9804
##  5 01    103    005701       46306        7926
##  6 01    103    005702       47769       12939
##  7 01    105    686800       30662        7299
##  8 01    009    050102       43325        9484
##  9 01    009    050300       37548        9655
## 10 01    009    050700       46452        5167
## # … with 1,171 more rows</code></pre>
<p>Smaller geographies like Census tracts can only be pulled state-by-state. This example demonstrates how to iterate across FIPS codes to pull Census tracts for multiple states. The process is as follows:</p>
<ol style="list-style-type: decimal">
<li>Pick the variables of interest</li>
<li>Create a vector of state FIPS codes for the states of interest</li>
<li>Create a custom function that works on a single state FIPS code</li>
<li>Iterate the function along the vector of state FIPS codes with <code>map_df()</code> from <code>library(purrr)</code></li>
</ol>
<p>Here is an example that pulls median household income at the Census tract level for multiple states:</p>
<pre class="r"><code># variables of interest
vars &lt;- c(
  &quot;B19013_001E&quot;,  # median household income estimate
  &quot;B19013_001M&quot;   # median household income margin of error
)

# states of interest: alabama, alaska, arizona
state_fips &lt;- c(&quot;01&quot;, &quot;02&quot;, &quot;04&quot;)
  
# create a custom function that works for one state
get_income &lt;- function(state_fips) {
  
  income_data &lt;- getCensus(name = &quot;acs/acs5&quot;,
                           vars = vars, 
                           region = &quot;tract:*&quot;,
                           regionin = paste0(&quot;state:&quot;, state_fips),
                           vintage = 2015)
  
  return(income_data)
  
}

# iterate the function
map_df(.x = state_fips, # iterate along the vector of state fips codes
       .f = get_income) %&gt;% # apply get_income() to each fips_code  
  as_tibble() </code></pre>
<pre><code>## # A tibble: 2,874 × 5
##    state county tract  B19013_001E B19013_001M
##    &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;        &lt;dbl&gt;       &lt;dbl&gt;
##  1 01    103    005109       29644        4098
##  2 01    103    005106       35864        3443
##  3 01    103    005107       66739        5468
##  4 01    103    005108       64632        9804
##  5 01    103    005701       46306        7926
##  6 01    103    005702       47769       12939
##  7 01    105    686800       30662        7299
##  8 01    009    050102       43325        9484
##  9 01    009    050300       37548        9655
## 10 01    009    050700       46452        5167
## # … with 2,864 more rows</code></pre>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
